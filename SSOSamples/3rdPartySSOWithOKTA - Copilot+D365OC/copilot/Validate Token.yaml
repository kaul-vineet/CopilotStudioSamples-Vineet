kind: AdaptiveDialog
beginDialog:
  kind: OnRedirect
  id: main
  actions:
    - kind: HttpRequestAction
      id: djSRId
      method: Post
      url: =Concatenate(<OktaValidationURL>, <cat_OktaValidationURI>)
      headers:
        accept: */*
        content-type: application/x-www-form-urlencoded

      body:
        kind: RawRequestContent
        contentType: application/x-www-form-urlencoded
        content: =Concatenate("token=",System.User.AccessToken,"&client_id=",<cat_OktaClientId>)

      response: Topic.VarInstrospectionResult
      responseSchema:
        kind: Record
        properties:
          active: Boolean
          aud: String
          client_id: String
          exp: Number
          iat: Number
          iss: String
          jti: String
          scope: String
          sub: String
          token_type: String
          uid: String
          username: String

    - kind: ConditionGroup
      id: conditionGroup_5XAZzU
      conditions:
        - id: conditionItem_m819xM
          condition: =Topic.VarInstrospectionResult.active = true
          actions:
            - kind: SendActivity
              id: sendActivity_m0CrTO
              activity: |-
                Welcome  {System.User.DisplayName}.

                Your Okta authenticator has identified you as {Topic.VarInstrospectionResult.username}. 

      elseActions:
        - kind: BeginDialog
          id: z9v8at
          dialog: cr097_vineetKaulAgent.topic.Signin